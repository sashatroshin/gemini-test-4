# План реализации для: Онлайн-форма для отчёта по смене

## Анализ функций
### Определенные функции:
- **Форма ввода данных:** Одностраничное приложение для ввода данных по кассовой смене, включая размен, расходы, данные из Presto и фактическую выручку.
- **Динамические расходы:** Возможность добавлять неограниченное количество полей для расходов (сумма, категория, комментарий).
- **Расчеты в реальном времени:** Боковая панель "Сводка за смену" для отображения итогов, которая обновляется по мере ввода данных.
- **Вычисления в полях ввода:** Поля для сумм поддерживают оператор `+` для быстрых расчетов на лету.
- **Внешняя конфигурация:** Все ключевые параметры (URL вебхука, категории расходов, тексты сообщений) загружаются из файла `config.json`.
- **Логика бизнес-даты:** Автоматическая смена бизнес-даты в указанное время и перезагрузка формы при необходимости.
- **Автосохранение:** Данные формы сохраняются в `localStorage` для текущей бизнес-даты, чтобы избежать потери данных при перезагрузке.
- **Интеграция с вебхуком:** Автоматическая отправка данных на указанный URL через 1 минуту после последнего изменения.
- **Обработка расхождений:** Система выводит информационные сообщения при обнаружении излишка или недостачи наличных и безналичных средств.

### Категоризация функций:
- **Обязательные функции:**
  - Форма ввода данных
  - Расчеты в реальном времени
  - Внешняя конфигурация (`config.json`)
  - Логика бизнес-даты
  - Автосохранение
  - Интеграция с вебхуком
  - Обработка расхождений
  - Вычисления в полях ввода (`+`)
- **Желательные функции:**
  - Валидация полей ввода (подсветка красным)
  - CI/CD для линтинга кода
- **Необязательные функции:**
  - В данном PRD не определены.

## Рекомендуемый технологический стек
### Фронтенд:
- **Технологии:** HTML, CSS, JavaScript (Vanilla JS)
- **Обоснование:** В соответствии с PRD, проект должен быть реализован как одностраничное приложение без использования фреймворков для максимальной легковесности и простоты.
- **Документация:**
  - [MDN Web Docs (HTML, CSS, JS)](https://developer.mozilla.org/)

### Бэкенд (Интеграция):
- **Технологии:** Fetch API (нативный JavaScript)
- **Обоснование:** Стандартный браузерный API для выполнения HTTP-запросов. Идеально подходит для отправки JSON-данных на вебхук n8n, как указано в требованиях.
- **Документация:**
  - [MDN - Using Fetch](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch)

### База данных:
- **Технологии:** Локальное хранилище браузера (Local Storage)
- **Обоснование:** Используется для временного хранения данных формы на стороне клиента для реализации функции автосохранения в рамках одной бизнес-даты.
- **Документация:**
  - [MDN - Window.localStorage](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage)

## Этапы реализации

### Этап 1: Основа и настройка
**Продолжительность:** 1 день
**Зависимости:** Нет

#### Подэтапы:
- [x] Создать структуру проекта (`index.html`, `style.css`, `app.js`, `config.json`).
- [x] Настроить базовую HTML-разметку с двухколоночной структурой.
- [x] Реализовать загрузку и парсинг `config.json` при старте приложения.
- [x] Настроить репозиторий GitHub.

### Этап 2: Реализация интерфейса и ввода данных
**Продолжительность:** 2 дня
**Зависимости:** Завершение этапа 1

#### Подэтапы:
- [x] Сверстать все статические поля ввода данных согласно PRD.
- [x] Реализовать динамическое добавление и удаление полей для расходов.
- [x] Заполнить выпадающий список категорий расходов из `config.json`.
- [x] Реализовать логику вычислений в полях ввода (обработка оператора `+`).
- [x] Реализовать валидацию полей ввода (подсветка при ошибке).

### Этап 3: Основная логика и расчеты
**Продолжительность:** 2 дня
**Зависимости:** Завершение этапа 2

#### Подэтапы:
- [x] Реализовать все расчеты для блока "Сводка за смену".
- [x] Настроить обновление сводки в реальном времени при изменении любого поля.
- [x] Реализовать логику автосохранения данных в `localStorage` при вводе.
- [x] Реализовать восстановление данных из `localStorage` при загрузке страницы для текущей бизнес-даты.
- [x] Реализовать логику смены бизнес-даты и принудительной перезагрузки страницы.

### Этап 4: Интеграция и завершение
**Продолжительность:** 1 день
**Зависимости:** Завершение этапа 3

#### Подэтапы:
- [x] Реализовать функцию сбора всех данных формы в требуемый JSON-формат.
- [x] Настроить отложенную отправку данных на вебхук (через 1 минуту после последнего изменения) с помощью `Fetch API`.
- [x] Реализовать отображение сообщений об излишках/недостачах на основе расчетов и шаблонов из `config.json`.
- [x] Провести комплексное тестирование всего функционала.
- [x] Подготовить проект к развертыванию через Easypanel.

## Ссылки на ресурсы
- [MDN Web Docs](https://developer.mozilla.org/) - Основной справочник по веб-технологиям.
- [Руководство по Fetch API](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch) - для реализации отправки данных.
- [Работа с JSON](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON) - для обработки `config.json` и данных вебхука.
- [Локальное хранилище (localStorage)](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage) - для функции автосохранения.
